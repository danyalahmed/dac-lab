# Kubeadm configuration for initializing Kubernetes control plane
# Generated by Ansible template
apiVersion: kubeadm.k8s.io/v1beta4
kind: InitConfiguration
localAPIEndpoint:
  advertiseAddress: {{ ansible_facts['default_ipv4']['address'] }}
  bindPort: 6443
nodeRegistration:
  name: {{ inventory_hostname }}
  criSocket: unix:///var/run/containerd/containerd.sock
  imagePullPolicy: IfNotPresent
{% if node_labels is defined and node_labels | length > 0 %}
  kubeletExtraArgs:
{% for key, value in node_labels.items() %}
    - name: node-labels
      value: "{{ key }}={{ value }}"
{% endfor %}
{% endif %}
---
apiVersion: kubeadm.k8s.io/v1beta4
kind: ClusterConfiguration
kubernetesVersion: {{ kubernetes_version }}
controlPlaneEndpoint: {{ ansible_facts['default_ipv4']['address'] }}:6443
networking:
  podSubnet: {{ pod_network_cidr }}
  serviceSubnet: {{ service_subnet }}
  dnsDomain: cluster.local
apiServer:
  certSANs:
    - {{ ansible_facts['default_ipv4']['address'] }}
    - {{ inventory_hostname }}
---
apiVersion: kubelet.config.k8s.io/v1beta1
kind: KubeletConfiguration
serverTLSBootstrap: true
maxPods: 110
clusterDNS:
  - {{ cluster_dns_ip }}